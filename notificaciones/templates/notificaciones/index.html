<!DOCTYPE html>
<html>
<head>
    <title>Notificaciones</title>
</head>
<body>
<h1>Notificaciones en tiempo real</h1>
<button onclick="enviarMensaje()">Enviar Global</button>
<ul id="mensajes"></ul>

<script>
const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
const socket = new WebSocket(protocol + window.location.host + "/apps/proyecto/ws/notificaciones/");

socket.onopen = () => console.log("Conectado ✅");
socket.onmessage = (e) => {
    const data = JSON.parse(e.data);
    const ul = document.getElementById("mensajes");
    const li = document.createElement("li");
    li.textContent = data.mensaje;
    ul.appendChild(li);
};
socket.onclose = () => console.log("Desconectado ❌");

function enviarMensaje() {
    fetch("enviar-global/").then(res => res.json()).then(data => {
    console.log("Respuesta JSON:", data);

    // Comprobar si tiene status=="error"
    if (data.status === "Unauthorized") {
      console.error("¡Error recibido del servidor!");
      alert('Login to send messages');
      // Aquí puedes hacer algo si hay error
    } else {
      console.log("Respuesta OK:", data);
    }
  });
}
</script>
</body>
</html>
